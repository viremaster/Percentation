<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>API user</title>

</head>

<body>
    <h1>Create User</h1>
    <form id="createUserForm">
        <input required type="text" name="name" id="createName" placeholder="Enter your name">
        <input required type="email" name="email" id="createEmail" placeholder="Enter your email">
        <input required type="password" name="password" id="createPassword" placeholder="Enter your password">
        <input required type="submit" value="Submit">
    </form>

    <h1>Login User</h1>
    <form id="loginUserForm">

        <form id="loginUserForm">
            <input required type="email" name="email" id="loginEmail" placeholder="Enter your email">
            <input required type="password" name="password" id="loginPassword" placeholder="Enter your password">
            <input required type="submit" value="Submit">
        </form>


        <button id="viewUsersButton">View all users</button>

        <script>
            let createUserForm = document.getElementById('createUserForm');

            let loginUserForm = document.getElementById("loginUserForm");

            let viewUsersButton = document.getElementById("viewUsersButton");

            viewUsersButton.onclick = function () {
                fetch("/app/users").then(data => {
                    if (data.status === 200) {
                        return data.json()
                    } else {
                        return new PromiseRejectionEvent();
                    }
                }).catch(err => {
                    console.error(err);
                })
            }

            createUserForm.onsubmit = function (e) {
                e.preventDefault();
                let createEmail = document.getElementById('createEmail'),
                    createName = document.getElementById('createName'),
                    createPassword = document.getElementById('createPassword');
                fetch('/app/user/', {
                        method: 'POST',
                        headers: {
                            "accept": "*/*",
                            'content-type': 'application/json'
                        },
                        body: JSON.stringify({
                            name: createName.value,
                            password: createPassword.value,
                            email: createEmail.value
                        })
                    }).then(function (res) {
                        return res.json();
                    })
                    .then(function (data) {
                        console.log(data);
                    });
            }

            loginUserForm.onsubmit = function (e) {
                e.preventDefault();
                let loginEmail = document.getElementById("loginEmail"),
                    loginPassword = document.getElementById("loginPassword");
                fetch(`app/user/${loginEmail}`).then(data=> {
                    if (data.status===200){
                        return data.json();
                    }else{
                        return new PromiseRejectionEvent();
                    }
                }).then(json => {
                    authenticatedUser=json;
                    console.log(authenticatedUser);
                })

            }
        </script>

</body>

</html>