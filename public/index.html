<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>API user</title>

</head>

<body>
    <h1>Create User</h1>
    <form id="createUserForm">
        <input required type="text" name="name" id="createName" placeholder="Enter your name">
        <input required type="email" name="email" id="createEmail" placeholder="Enter your email">
        <input required type="password" name="password" id="createPassword" placeholder="Enter your password">
        <input required type="submit" value="Create">
    </form>

    <h1>Login User</h1>

    <form id="loginUserForm">
        <input required type="email" name="email" id="loginEmail" placeholder="Enter your email">
        <input required type="password" name="password" id="loginPassword" placeholder="Enter your password">
        <input required type="submit" value="Login">
    </form>

    <h1>Delete User</h1>
    <form id="DeleteUserForm">
        <input required type="email" name="email" id="deleteEmail" placeholder="Enter your email">
        <input required type="password" name="password" id="deletePassword" placeholder="Enter your password">
        <input type="submit" value="Delete">
    </form>


    <button id="viewUsersButton">View all users</button>

    <script>
        let createUserForm = document.getElementById('createUserForm');

        let loginUserForm = document.getElementById("loginUserForm");

        let viewUsersButton = document.getElementById("viewUsersButton");

        let DeleteUserForm = document.getElementById("DeleteUserForm");

        viewUsersButton.onclick = function () {
            fetch("/app/users").then(data => {
                if (data.status === 200) {
                    return data.json()
                } else {
                    return new PromiseRejectionEvent();
                }
            }).catch(err => {
                console.error(err);
            })
        }

        createUserForm.onsubmit = function (e) {
            e.preventDefault();
            let createEmail = document.getElementById('createEmail'),
                createName = document.getElementById('createName'),
                createPassword = document.getElementById('createPassword');
            fetch('/app/user', {
                    method: 'POST',
                    headers: {
                        "accept": "*/*",
                        'content-type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: createName.value,
                        password: createPassword.value,
                        email: createEmail.value
                    })
                }).then(function (res) {
                    return res.json();
                })
                .then(function (data) {
                    console.log(data);
                });
        }

        loginUserForm.onsubmit = function (e) {
            e.preventDefault();
            let loginEmail = document.getElementById("loginEmail").value,
                loginPassword = document.getElementById("loginPassword").value;
            fetch(`app/user`, {
                method: "GET",
                headers: new Headers({
                    'Authorization': 'Basic ' + btoa(loginEmail + ':' + loginPassword),
                    'Content-Type': 'application/x-www-form-urlencoded'
                })
            }).then(data => {
                if (data.status === 200) {
                    return data.json();
                } else {
                    return new PromiseRejectionEvent();
                }
            }).then(json => {
                authenticatedUser = json;
                console.log("Authenticated User : "+authenticatedUser.username);
            })

        }

        DeleteUserForm.onsubmit = function (e) {
            e.preventDefault();
            let deleteEmail = document.getElementById("deleteEmail").value,
                deletePassword = document.getElementById("deletePassword").value;

            fetch("app/user", {
                method: "DELETE",
                headers: new Headers({
                    'Authorization': 'Basic ' + btoa(deleteEmail + ':' + deletePassword),
                    'Content-Type': 'application/x-www-form-urlencoded'
                })
            }).then(data => {
                if (data.status === 200) {
                    return data.json();
                }else{
                    return new PromiseRejectionEvent();
                }
            }).then(json => {
                console.log(json);
            })

        }
    </script>

</body>

</html>